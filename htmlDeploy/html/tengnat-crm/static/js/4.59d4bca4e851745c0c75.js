webpackJsonp([4],{"7V40":function(e,t){},"8Cq6":function(e,t,r){"use strict";var a=r("4YfN"),o=r.n(a),i=r("39zi"),s=r("Week"),l=r("hFFN"),n=r("G+Zt"),d=r("GObz"),m=r("VnLn"),c=r("2bvH"),u=r("ryJa"),p=r.n(u),f={props:["orderInfo","status"],data:function(){return{order:{orderNo:"",customerName:"",orderStatus:"",orderType:null,contract:"",userName:"",totalMoney:"",contacts:"",mobile:"",orderTime:null,openTime:null,remark:"",contractFile:[],contractFileList:[],orderFiles:[],orderFileList:[],orderItems:[],installments:[],installmentdelete:[]},installmentItem:{visible:!1,search:{keyword:""},insert:{visible:!1,width:"70px",form:{orderId:"",fund:"",money:null,status:"",remark:"",createTime:""}},update:{visible:!1,width:"70px",form:{orderId:"",fund:"",money:null,status:"",remark:"",createTime:""}}},process:"",activeId:"first",userModal:{visible:!1,dataList:[],value:"",remark:""},barge:{visible:!1,remark:""},orderStep:{rejectedStep:[],crmOrderAuditProcess:[]},dynamic:{dynamicList:[],modal:{open:{visible:!1},insert:{visible:!1,labelWith:"80px",form:{dynamicId:"",orderId:"",dynameicType:1,visitTime:"",planTime:"",visitway:[],visitContent:"",type:1}},update:{visible:!1,labelWith:"80px",form:{dynamicId:"",orderId:"",dynameicType:1,visitTime:"",planTime:"",visitway:[],visitContent:"",type:1}}}},search:{visitwayList:[],app:{value:"",appList:[{label:"SAP-B1",value:"SAP-B1"},{label:"云MES",value:"云MES"},{label:"CRM",value:"CRM"}]}},center:{lng:0,lat:0},zoom:3,position:{lng:0,lat:0},positionAadress:""}},computed:o()({},Object(c.c)(["orderStatus","loginUserInfo"]),{stepActive:function(){for(var e=0;e<this.orderStatus.length;e++){this.orderStatus[e].error="";var t=this.orderStatus[e];if(this.order.orderStatus===t.key){for(var r=1;r<=e;r++)this.orderStatus[r].error="";return e===this.orderStatus.length-1?e+1:e}for(var a=0;a<this.orderStep.rejectedStep.length;a++){var o=this.orderStep.rejectedStep[a];t.key===o&&(this.orderStatus[e].error="error")}}}}),mounted:function(){this.renderSaleOrderInfo(),this.aaaa(),this.getOrderSaleDynamicList(),this.getDynamicList()},methods:{showOStart:function(e){return"ORDER_WAIT_COMMIT"!==e},showOrderStart:function(e){return"ORDER_COMPLETE"!==e},showStart:function(e,t){return e===this.loginUserInfo.userId||"ORDER_WAIT_COMMIT"===t},showInserInstallment:function(e){return e===this.loginUserInfo.userId},timeStampToTime:function(e){return p()(e).format("YYYY-MM-DD HH:mm:ss")},timeStampToTimeDay:function(e){return p()(e).format("YYYY-MM-DD")},getOrderSaleDynamicList:function(){var e=this;Object(m.v)({orderId:this.orderInfo.orderId}).then(function(t){e.dynamic.dynamicList=t.data.data}).catch(function(e){})},addDynamic:function(){var e=this;this.dynamic.modal.insert.form.orderId=this.orderInfo.orderId,this.dynamic.modal.insert.form.dynameicType=1,this.dynamic.modal.insert.form.planTime="",this.dynamic.modal.insert.form.visitTime="",this.dynamic.modal.insert.form.visitway=[],this.dynamic.modal.insert.form.visitContent="",this.dynamic.modal.insert.form.type=1,this.dynamic.modal.insert.visible=!0,this.$nextTick(function(){e.$refs.dynamicadd.resetFields()})},addOrderSaleDynamicSubmit:function(){var e=this;this.$refs.dynamicadd.validate(function(t){if(!t)return e.$message.error("请输入正确的内容"),!1;Object(m.F)(e.dynamic.modal.insert.form).then(function(t){t.data.code===e.$global.successCode&&(e.$message({message:"添加成功",type:"success"}),e.dynamic.modal.insert.visible=!1,e.getOrderSaleDynamicList())}).catch(function(e){})})},updateDynamic:function(e){""===e.visitType||null===e.visitType?this.dynamic.modal.update.form.dynameicType=1:this.dynamic.modal.update.form.dynameicType=e.visitType,this.dynamic.modal.update.form.dynamicId=e.dynamicId,this.dynamic.modal.update.form.visitTime=e.visitTime,this.dynamic.modal.update.form.planTime=e.planTime,this.dynamic.modal.update.form.visitway=e.visitIdList,this.dynamic.modal.update.form.visitContent=e.visitContent,this.dynamic.modal.update.visible=!0},updateOrderSaleDynamicSubmit:function(){var e=this;Object(m.R)(this.dynamic.modal.update.form).then(function(t){t.data.code===e.$global.successCode&&(e.$message({message:"修改成功",type:"success"}),e.dynamic.modal.update.visible=!1,e.getOrderSaleDynamicList())}).catch(function(e){})},deleteOrderSaleDynamicSubmit:function(e){var t=this;this.$confirm("是否确定删除该动态","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(m.L)(e).then(function(e){e.data.code===t.$global.successCode&&(t.$message({message:"删除成功",type:"success"}),t.dynamic.modal.update.visible=!1,t.getOrderSaleDynamicList())}).catch(function(e){})}).catch(function(){})},aaaa:function(){var e=this;Object(l.c)({orderNo:this.orderInfo.orderNo}).then(function(t){e.orderStep.rejectedStep=t.data.data.rejectedStep,e.orderStep.crmOrderAuditProcess=t.data.data.crmOrderAuditProcess}).catch(function(e){})},approver:function(){for(var e=this.orderInfo.orderStatus,t=this.status.items,r=0,a=0;r<t.length;r++)t[r].name===e&&(a=t[r].tabIndex);return this.status.items.length-(parseInt(a)+1)!=1||(this.title="审批意见",!1)},according:function(e){if(this.orderStep.crmOrderAuditProcess.length>=0){for(var t=[],r=0;r<this.orderStep.crmOrderAuditProcess.length;r++)t.push(this.orderStep.crmOrderAuditProcess[r].opKey);return t.indexOf(e)>=0}return!1},on_click:function(e){},getRequestParams:function(){var e={order:this.orderInfo.orderNo};return this.installmentItem.search.keyword&&(e.keyword=this.installmentItem.search.keyword),e},renderSaleOrderInfo:function(){var e=this;Object(l.e)(this.getRequestParams()).then(function(t){e.order=t.data.data;for(var r=0;r<e.status.items.length;r++)e.order.orderStatus===e.status.items[r].name&&(e.process=e.status.items[r])}).catch(function(e){})},getAfterDiscountMoney:function(e){return e.userCountMoney+e.implMoney-e.discountMoney},getTotalMoney:function(){var e=0;return this.order.orderItems.forEach(function(t){e=t.userCountMoney+t.implMoney-t.discountMoney}),Object(i.b)(e.toFixed(2))+"  "+Object(i.a)(e.toFixed(2))},formatTimeStamp:function(e){return p()(e).format("YYYY-MM-DD")},operation:function(){if(void 0!==this.process.label)return this.process.label.substring(1)},examinationApproval:function(){var e=this;this.userModal.visible=!0,Object(n.d)({opKey:this.process.name}).then(function(t){t.data.code===e.$global.successCode&&(e.userModal.dataList=t.data.data)}).catch(function(e){})},examinationApprovalSubmit:function(){var e=this,t=this.operation();if(this.approver()){if(""===this.userModal.value)return void this.$message({message:"请选择审批人",type:"warning"})}else this.userModal.value=this.order.cuUserId;Object(l.b)({orderNo:this.order.orderNo,toUserId:this.userModal.value,opKey:this.process.name,remark:this.userModal.remark}).then(function(r){r.data.code===e.$global.successCode&&(e.$message({message:"订单"+t+"成功",type:"success"}),e.userModal.visible=!1,e.$emit("close-detail-tab",e.order.orderNo))}).catch(function(e){})},orderBarge:function(){this.barge.visible=!0},orderBargeSubmit:function(){var e=this;Object(l.l)({orderNo:this.order.orderNo,remark:this.barge.remark,opKey:this.process.name}).then(function(t){t.data.code===e.$global.successCode&&(e.$message({message:"订单驳回成功",type:"success"}),e.barge.visible=!1,e.$emit("close-detail-tab",e.order.orderNo))}).catch(function(e){})},downloadAction:function(e){Object(s.c)(e.fileName).then(function(t){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(t.data,e.originName);else{var r=document.createElement("a"),a=window.URL.createObjectURL(t.data);r.href=a,r.download=e.originName,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a)}}).catch(function(e){})},calculateMoney:function(e){return e?Number(e):Number(0)},getMoneys:function(){var e=this,t=0;return this.order.installments.forEach(function(r){t+=e.calculateMoney(r.money)}),Object(i.b)(t.toFixed(2))+"  "+Object(i.a)(t.toFixed(2))},getInstaStatus:function(e){return Object(d.c)(e)},installment:function(){this.installmentItem.visible=!0},doSearch:function(){this.renderSaleOrderInfo()},addInstallment:function(){this.installmentItem.insert.visible=!0,this.installmentItem.insert.form.orderId=this.order.orderId,this.installmentItem.insert.form.fund="",this.installmentItem.insert.form.money=null,this.installmentItem.insert.form.status=0,this.installmentItem.insert.form.remark=""},insertInstallment:function(){this.installmentItem.insert.visible=!1,this.installmentItem.insert.form.status=2,this.addSubmitInstallment(this.installmentItem.insert.form)},insertSubmitInsertInstallmentIem:function(){this.installmentItem.insert.visible=!1,this.installmentItem.insert.form.status=0,this.addSubmitInstallment(this.installmentItem.insert.form)},addSubmitInstallment:function(e){var t=this;Object(l.j)(e).then(function(e){e.data.code===t.$global.successCode&&(t.$message({message:"添加成功",type:"success"}),t.installmentItem.insert.visible=!1,t.renderSaleOrderInfo())}).catch(function(e){})},removeOrderInstallmentItem:function(e){var t=this;this.$confirm("是否确定移除该收款项","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(l.k)({coiId:e}).then(function(e){e.data.code===t.$global.successCode&&(t.$message({message:"删除成功",type:"success"}),t.renderSaleOrderInfo())}).catch(function(e){})}).catch(function(){})},editorOrderInstallmentItem:function(e){this.installmentItem.update.visible=!0,this.installmentItem.update.form.fund=e.fund,this.installmentItem.update.form.money=e.money,this.installmentItem.update.form.status=e.status,this.installmentItem.update.form.remark=e.remark,this.installmentItem.update.form.coiId=e.coiId},showEditor:function(e){return void 0===e.coiId||(void 0!==e.coiId&&2===e.status||void 0)},editorInsertInstallmentIem:function(){this.installmentItem.update.visible=!1,this.installmentItem.update.form.status=2,this.editorSubmitInstallment(this.installmentItem.update.form)},editorsubmitInsertInstallmentIem:function(){this.installmentItem.update.visible=!1,this.installmentItem.update.form.status=0,this.editorSubmitInstallment(this.installmentItem.update.form)},editorSubmitInstallment:function(e){var t=this;Object(l.i)(e).then(function(e){e.data.code===t.$global.successCode&&(t.$message({message:"修改成功",type:"success"}),t.installmentItem.insert.visible=!1,t.renderSaleOrderInfo())}).catch(function(e){})},commonurl3:function(e){return"static/3.png"},getDynamicList:function(){var e=this;Object(n.i)().then(function(t){e.search.visitwayList=t.data.data}).catch(function(e){})},updateDynamicsss:function(e,t,r){this.center.lng=e,this.center.lat=t,this.zoom=15,this.position.lng=e,this.position.lat=t,this.positionAadress=r,this.dynamic.modal.open.visible=!0},updateDynamicssssss:function(){this.$message({message:"外访打卡不能删除",type:"warning"})},infoWindowClose:function(){this.show=!1},infoWindowOpen:function(){var e=this;setInterval(function(){e.show=!0},100)}}},v={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"sales-order"},[r("div",{staticClass:"order-header"},[r("div",{staticClass:"order-header-img"},[r("img",{attrs:{src:e.commonurl3("订单"),alt:"image"}})]),e._v(" "),r("div",{staticClass:"order-header-content"},[r("div",{staticClass:"order-header-order-no"},[r("el-button",{attrs:{type:"text"}},[e._v("订单号:"+e._s(e.order.orderNo))])],1),e._v(" "),r("div",{staticClass:"order-header-font"},[r("div",{staticClass:"order-header-font1"},[e._v("合同编号")]),e._v(" "),r("div",{staticClass:"order-header-font2"},[e._v(e._s(e.order.contract))])]),e._v(" "),r("div",{staticClass:"order-header-font"},[r("div",{staticClass:"order-header-font1"},[e._v("客户名称")]),e._v(" "),r("div",{staticClass:"order-header-font2"},[e._v(e._s(e.order.customerName))])]),e._v(" "),r("div",{staticClass:"order-header-font"},[r("div",{staticClass:"order-header-font1"},[e._v("下单日期")]),e._v(" "),r("div",{staticClass:"order-header-font2"},[e._v(e._s(e.timeStampToTimeDay(e.order.orderTime)))])]),e._v(" "),e._m(0),e._v(" "),r("div",{staticClass:"order-header-font"},[r("div",{staticClass:"order-header-font1"},[e._v("所属销售")]),e._v(" "),r("div",{staticClass:"order-header-font2"},[e._v(e._s(e.order.userName))])])]),e._v(" "),r("div",{staticClass:"order-header-right"},[r("div",{staticClass:"order-header-button"},[e.showStart(e.order.cuUserId,e.order.orderStatus)&&e.showOrderStart(e.order.orderStatus)?r("div",[e.showOStart(e.order.orderStatus)?r("el-button",{attrs:{type:"primary"},on:{click:e.orderBarge}},[e._v("驳回\n                    ")]):e._e(),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.examinationApproval}},[e._v(e._s(e.operation()))])],1):r("div",{staticStyle:{width:"20px",height:"30px"}})]),e._v(" "),r("div",{staticClass:"order-header-right-font"},[r("div",{staticClass:"order-header-font1"},[e._v("状态")]),e._v(" "),r("div",{staticClass:"order-header-font3"},[e._v("\n                    "+e._s(e.order.orderStatusName)+"\n                ")])]),e._v(" "),r("div",{staticClass:"order-header-right-font"},[r("div",{staticClass:"order-header-font1"},[e._v("订单金额")]),e._v(" "),r("div",{staticClass:"order-header-font3"},[e._v(e._s(e.order.totalMoney))])])])]),e._v(" "),r("div",{staticClass:"order-steps"},[r("div",{staticClass:"box-order-steps"},[r("el-steps",{attrs:{active:e.stepActive,"finish-status":"success","process-status":"finish","align-center":!0}},e._l(e.orderStatus,function(t){return r("el-step",{key:t.key,attrs:{status:t.error},nativeOn:{click:function(r){return e.on_click(t.key)}}},[r("template",{slot:"title"},[r("el-popover",{ref:t.key,refInFor:!0,attrs:{placement:"bottom",width:"200",trigger:"hover"}},[e.according(t.key)?r("div",e._l(e.orderStep.crmOrderAuditProcess,function(a){return t.key==a.opKey?r("div",{staticClass:"box-process"},[r("div",{staticClass:"box-img"},[r("img",{attrs:{src:a.userPhoto}})]),e._v(" "),r("div",{staticClass:"box-text1"},[r("span",[e._v(e._s(a.userName))])]),e._v(" "),r("div",{staticClass:"box-text1"},[r("span",[e._v(e._s(a.postName))])]),e._v(" "),r("div",{staticClass:"box-text2"},[r("span",{staticClass:"text"},[e._v("意见："+e._s(a.opinion))])])]):e._e()}),0):r("div",[e._v("暂无意见")])]),e._v(" "),r("el-button",{directives:[{name:"popover",rawName:"v-popover",value:t.key,expression:"status.key"}]},[e._v(e._s(t.name))])],1)],2)}),1)],1)]),e._v(" "),r("div",{staticClass:"sales-order-info",staticStyle:{width:"calc(100% - 30px)",background:"white",margin:"15px 15px 0 15px"}},[r("div",[r("el-row",{staticClass:"order-Detail"},[r("el-col",{staticClass:"order-Detail-col1",attrs:{span:18}},[r("div",{staticClass:"box-order-info box-order-info-detail"},[r("div",{staticClass:"box-order-menu"},[r("div",{staticClass:"box-order-info-title"},[e._v("订单信息")])]),e._v(" "),r("el-form",{attrs:{inline:!0,model:e.order}},[r("div",{staticClass:"box-item-row"},[r("el-form-item",{attrs:{label:"订单号："}},[r("el-input",{attrs:{readonly:!0},model:{value:e.order.orderNo,callback:function(t){e.$set(e.order,"orderNo",t)},expression:"order.orderNo"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"合同编号："}},[r("el-input",{attrs:{readonly:!0},model:{value:e.order.contract,callback:function(t){e.$set(e.order,"contract",t)},expression:"order.contract"}})],1)],1),e._v(" "),r("div",{staticClass:"box-item-row"},[r("el-form-item",{attrs:{label:"订单类型："}},[r("el-input",{attrs:{readonly:!0},model:{value:e.order.orderType,callback:function(t){e.$set(e.order,"orderType",t)},expression:"order.orderType"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"客户名称："}},[r("el-input",{attrs:{readonly:!0},model:{value:e.order.customerName,callback:function(t){e.$set(e.order,"customerName",t)},expression:"order.customerName"}})],1)],1),e._v(" "),r("div",{staticClass:"box-item-row"},[r("el-form-item",{attrs:{label:"所属销售："}},[r("el-input",{attrs:{readonly:!0},model:{value:e.order.userName,callback:function(t){e.$set(e.order,"userName",t)},expression:"order.userName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"订单金额："}},[r("el-input",{attrs:{readonly:!0},model:{value:e.order.totalMoney,callback:function(t){e.$set(e.order,"totalMoney",t)},expression:"order.totalMoney"}})],1)],1),e._v(" "),r("div",{staticClass:"box-item-row"},[r("el-form-item",{attrs:{label:"联系人："}},[r("el-input",{attrs:{readonly:!0},model:{value:e.order.contacts,callback:function(t){e.$set(e.order,"contacts",t)},expression:"order.contacts"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"手机："}},[r("el-input",{attrs:{readonly:!0},model:{value:e.order.mobile,callback:function(t){e.$set(e.order,"mobile",t)},expression:"order.mobile"}})],1)],1),e._v(" "),r("div",{staticClass:"box-item-row"},[r("el-form-item",{attrs:{label:"下单日期："}},[r("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",readonly:!0},model:{value:e.order.orderTime,callback:function(t){e.$set(e.order,"orderTime",t)},expression:"order.orderTime"}})],1)],1),e._v(" "),r("div",{staticClass:"box-item-row order-file"},[r("el-form-item",{staticClass:"box-item-button",attrs:{label:"合同文件："}},[e.order.contractFileList.length>0?r("ul",e._l(e.order.contractFileList,function(t){return r("li",{key:t.fileId,attrs:{title:"点击下载"},on:{click:function(r){return e.downloadAction(t)}}},[r("div",{staticClass:"file-name-list"},[r("i",{staticClass:"el-icon-document"}),e._v("\n                                                "+e._s(t.originName)+"\n                                            ")]),e._v(" "),r("div",{staticClass:"icon-label"},[r("i",{staticClass:"el-icon-circle-check"})])])}),0):r("div",{staticClass:"box-file-none"},[e._v("暂无合同文件")])])],1),e._v(" "),r("div",{staticClass:"box-item-row order-file"},[r("el-form-item",{staticClass:"box-item-button",attrs:{label:"下单文件："}},[e.order.orderFileList.length>0?r("ul",e._l(e.order.orderFileList,function(t){return r("li",{key:t.fileId,attrs:{title:t.originName},on:{click:function(r){return e.downloadAction(t)}}},[r("div",{staticClass:"file-name-list"},[r("i",{staticClass:"el-icon-document"}),e._v("\n                                                "+e._s(t.originName)+"\n                                            ")]),e._v(" "),r("div",{staticClass:"icon-label"},[r("i",{staticClass:"el-icon-circle-check"})])])}),0):r("div",{staticClass:"box-file-none"},[e._v("暂无下单文件")])])],1),e._v(" "),r("div",{staticClass:"box-item-row"},[r("el-form-item",{staticClass:"box-item-textarea",attrs:{label:"备注："}},[r("el-input",{attrs:{readonly:!0},model:{value:e.order.remark,callback:function(t){e.$set(e.order,"remark",t)},expression:"order.remark"}})],1)],1)]),e._v(" "),r("div",{staticStyle:{height:"10px"}})],1),e._v(" "),r("div",{staticClass:"box-order-item-list"},[r("el-tabs",{staticClass:"detail-tabs",model:{value:e.activeId,callback:function(t){e.activeId=t},expression:"activeId"}},[r("el-tab-pane",{attrs:{label:"订单明细",name:"first"}},[r("div",{staticStyle:{margin:"15px 15px 15px 15px"}},[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.order.orderItems,height:"190"}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"productName",label:"产品",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"productVersion",label:"版本/PL",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"userCount",label:"平台用户数",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"deliveryPackage",label:"交付包",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"standardContractMoney",label:"合同标准金额",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"userCountMoney",label:"用户数总金额",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"implMoney",label:"实施费总金额",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"discountMoney",label:"优惠金额",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{label:"优惠后合同总金额",width:"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.getAfterDiscountMoney(t.row)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"开户日期",width:"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.formatTimeStamp(t.row.openAccountTime)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"到期日",width:"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.formatTimeStamp(t.row.expireTime)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"expire",label:"期限",width:"120","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column")],1)],1)]),e._v(" "),r("el-tab-pane",{attrs:{label:"回款明细",name:"second"}},[r("div",{staticStyle:{margin:"15px 15px 15px 15px"}},[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.order.installments,height:"190"}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"fund",label:"收款项",width:"150","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"money",label:"收款金额",width:"180","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{label:"收款时间",width:"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.formatTimeStamp(t.row.createTime)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"remark",label:"备注","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{label:"审核状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{on:{click:function(r){return e.getInstaStatus(t.row)}}},[e._v(e._s(e.getInstaStatus(t.row).desc))])]}}])}),e._v(" "),r("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.showEditor(t.row)?r("el-button",{attrs:{icon:"el-icon-edit",type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.editorOrderInstallmentItem(t.row)}}},[e._v("编辑\n                                                ")]):r("el-button",{attrs:{icon:"el-icon-edit",disabled:"",type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.editorOrderInstallmentItem(t.row)}}},[e._v("编辑\n                                                ")]),e._v(" "),e.showEditor(t.row)?r("el-button",{attrs:{icon:"el-icon-close",type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.removeOrderInstallmentItem(t.row.coiId)}}},[e._v("移除\n                                                ")]):r("el-button",{attrs:{icon:"el-icon-close",disabled:"",type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.removeOrderInstallmentItem(t.row.coiId)}}},[e._v("移除\n                                                ")])]}}])})],1),e._v(" "),r("div",{staticClass:"order-table-total",staticStyle:{background:"white"}},[r("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-plus"},on:{click:e.addInstallment}},[e._v("添加行\n                                        ")])],1),e._v(" "),r("div",{staticClass:"order-table-total"},[e._v("\n                                        合计："+e._s(e.getMoneys())+"\n                                    ")])],1)])],1)],1)]),e._v(" "),r("el-col",{staticClass:"order-Detail-col2",attrs:{span:6}},[r("div",{staticClass:"box-order-menu"},[r("div",{staticClass:"box-order-info-title"},[e._v("动态")])]),e._v(" "),r("div",{staticClass:"order-dynamic"},[r("div",{staticClass:"order-dynamic-top"},[r("div",{staticClass:"order-dynamic-top-1"}),e._v(" "),r("div",{staticClass:"order-dynamic-top-2"}),e._v(" "),r("div",{staticClass:"order-dynamic-top-3"},[r("el-button",{attrs:{type:"text"},on:{click:e.addDynamic}},[e._v("新增")])],1)]),e._v(" "),e._l(e.dynamic.dynamicList,function(t){return r("div",{staticClass:"height100"},[r("div",{staticClass:"dynamic-img"},[r("img",{attrs:{src:t.userPhoto,alt:"image"}})]),e._v(" "),r("el-tooltip",{attrs:{content:t.visitContent,placement:"bottom",effect:"light"}},[2===t.visitType?r("div",{staticClass:"dynamic-text"},[r("div",{staticClass:"dynamic-text-1"},[r("span",{staticClass:"dynamic-text-3"},[e._v(e._s(t.userName))]),e._v("  "+e._s(e.timeStampToTimeDay(t.visitTime))+"\n                                    ")]),e._v(" "),r("div",{staticClass:"dynamic-text-2"},[r("span",{staticClass:"dynamic-text-4"},[e._v("进行了外访打卡")]),e._v(" "),r("div",{staticStyle:{float:"right","margin-top":"-40px","margin-right":"10px"}},[r("a",{attrs:{href:"#"},on:{click:function(r){return e.updateDynamicsss(t.positionX,t.positionY,t.address)}}},[r("i",{staticClass:"el-icon-edit-outline",staticStyle:{color:"#0ae"},attrs:{"aria-hidden":"true"}})]),e._v(" \n                                            "),r("a",{attrs:{href:"#"},on:{click:function(t){return e.updateDynamicssssss()}}},[r("i",{staticClass:"el-icon-close",staticStyle:{color:"#0ae"},attrs:{"aria-hidden":"true"}})])])])]):e._e(),e._v(" "),r("div",{staticClass:"dynamic-text"},[1===t.visitType?r("div",{staticClass:"dynamic-text-1"},[r("span",{staticClass:"dynamic-text-3"},[e._v(e._s(t.userName))]),e._v("  "+e._s(e.timeStampToTimeDay(t.planTime))+"\n                                ")]):r("div",{staticClass:"dynamic-text-1"},[r("span",{staticClass:"dynamic-text-3"},[e._v(e._s(t.userName))]),e._v("  "+e._s(e.timeStampToTimeDay(t.visitTime))+"\n                                ")]),e._v(" "),r("div",{staticClass:"dynamic-text-2"},[r("span",{staticClass:"dynamic-text-4"},[e._v("与客户进行了"+e._s(t.visitWay))]),e._v(" "),r("div",{staticStyle:{float:"right","margin-top":"-40px","margin-right":"10px"}},[r("a",{attrs:{href:"#"},on:{click:function(r){return e.updateDynamic(t)}}},[r("i",{staticClass:"el-icon-edit-outline",staticStyle:{color:"#0ae"},attrs:{"aria-hidden":"true"}})]),e._v(" \n                                        "),r("a",{attrs:{href:"#"},on:{click:function(r){return e.deleteOrderSaleDynamicSubmit(t)}}},[r("i",{staticClass:"el-icon-close",staticStyle:{color:"#0ae"},attrs:{"aria-hidden":"true"}})])])])])])],1)})],2)])],1)],1)]),e._v(" "),r("el-dialog",{staticClass:"custom-dialog",attrs:{title:"选择审批人",visible:e.userModal.visible},on:{"update:visible":function(t){return e.$set(e.userModal,"visible",t)}}},[r("el-form",[e.approver()?r("el-form-item",[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.userModal.value,callback:function(t){e.$set(e.userModal,"value",t)},expression:"userModal.value"}},e._l(e.userModal.dataList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e(),e._v(" "),r("el-form-item",[r("el-input",{attrs:{placeholder:"审批意见",type:"textarea",autosize:{minRows:4,maxRows:4}},model:{value:e.userModal.remark,callback:function(t){e.$set(e.userModal,"remark",t)},expression:"userModal.remark"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.examinationApprovalSubmit}},[e._v("确 定")]),e._v(" "),r("el-button",{on:{click:function(t){e.userModal.visible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog",attrs:{title:"驳回意见",visible:e.barge.visible},on:{"update:visible":function(t){return e.$set(e.barge,"visible",t)}}},[r("el-form",[r("el-form-item",[r("el-input",{attrs:{placeholder:"审批意见",type:"textarea",autosize:{minRows:4,maxRows:4}},model:{value:e.barge.remark,callback:function(t){e.$set(e.barge,"remark",t)},expression:"barge.remark"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.orderBargeSubmit}},[e._v("确 定")]),e._v(" "),r("el-button",{on:{click:function(t){e.barge.visible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog",attrs:{title:"添加动态",visible:e.dynamic.modal.insert.visible},on:{"update:visible":function(t){return e.$set(e.dynamic.modal.insert,"visible",t)}}},[r("el-form",{ref:"dynamicadd",attrs:{model:e.dynamic.modal.insert.form}},[r("el-form-item",{attrs:{label:"动态主题","label-width":e.dynamic.modal.insert.labelWith,prop:"dynameicType",rules:[{required:!0,message:"选择动态类型",trigger:"change"}]}},[r("el-radio-group",{model:{value:e.dynamic.modal.insert.form.dynameicType,callback:function(t){e.$set(e.dynamic.modal.insert.form,"dynameicType",t)},expression:"dynamic.modal.insert.form.dynameicType"}},[r("el-radio",{attrs:{size:"small",label:1}},[e._v("计划")]),e._v(" "),r("el-radio",{attrs:{size:"small",label:0}},[e._v("完成")])],1)],1),e._v(" "),1===e.dynamic.modal.insert.form.dynameicType?r("el-form-item",{attrs:{label:"计划时间","label-width":e.dynamic.modal.insert.labelWith,prop:"planTime",rules:[{required:!0,message:"请输入计划时间",trigger:"change"}]}},[r("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:e.dynamic.modal.insert.form.planTime,callback:function(t){e.$set(e.dynamic.modal.insert.form,"planTime",t)},expression:"dynamic.modal.insert.form.planTime"}})],1):r("el-form-item",{attrs:{label:"完成时间","label-width":e.dynamic.modal.insert.labelWith,prop:"visitTime",rules:[{required:!0,message:"请输入完成时间",trigger:"change"}]}},[r("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:e.dynamic.modal.insert.form.visitTime,callback:function(t){e.$set(e.dynamic.modal.insert.form,"visitTime",t)},expression:"dynamic.modal.insert.form.visitTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"动态类型","label-width":e.dynamic.modal.insert.labelWith,prop:"visitway",rules:[{required:!0,message:"选择动态类型",trigger:"change"}]}},[r("el-cascader",{attrs:{options:e.search.visitwayList,"change-on-select":"",placeholder:"请选择"},model:{value:e.dynamic.modal.insert.form.visitway,callback:function(t){e.$set(e.dynamic.modal.insert.form,"visitway",t)},expression:"dynamic.modal.insert.form.visitway"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"内容","label-width":e.dynamic.modal.insert.labelWith,prop:"visitContent",rules:[{required:!0,message:"请输入内容",trigger:"change"}]}},[r("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.dynamic.modal.insert.form.visitContent,callback:function(t){e.$set(e.dynamic.modal.insert.form,"visitContent",t)},expression:"dynamic.modal.insert.form.visitContent"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.addOrderSaleDynamicSubmit}},[e._v("确 定")]),e._v(" "),r("el-button",{on:{click:function(t){e.dynamic.modal.insert.visible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog",attrs:{title:"修改动态",visible:e.dynamic.modal.update.visible},on:{"update:visible":function(t){return e.$set(e.dynamic.modal.update,"visible",t)}}},[r("el-form",{attrs:{model:e.dynamic.modal.update.form}},[r("el-form-item",{attrs:{label:"动态主题","label-width":e.dynamic.modal.insert.labelWith}},[r("el-radio-group",{model:{value:e.dynamic.modal.update.form.dynameicType,callback:function(t){e.$set(e.dynamic.modal.update.form,"dynameicType",t)},expression:"dynamic.modal.update.form.dynameicType"}},[r("el-radio",{attrs:{size:"small",label:1}},[e._v("计划")]),e._v(" "),r("el-radio",{attrs:{size:"small",label:0}},[e._v("完成")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"计划时间","label-width":e.dynamic.modal.update.labelWith}},[1===e.dynamic.modal.update.form.dynameicType?r("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:e.dynamic.modal.update.form.planTime,callback:function(t){e.$set(e.dynamic.modal.update.form,"planTime",t)},expression:"dynamic.modal.update.form.planTime"}}):r("el-date-picker",{attrs:{disabled:"",type:"datetime",placeholder:"选择日期时间"},model:{value:e.dynamic.modal.update.form.planTime,callback:function(t){e.$set(e.dynamic.modal.update.form,"planTime",t)},expression:"dynamic.modal.update.form.planTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"完成时间","label-width":e.dynamic.modal.update.labelWith}},[2===e.dynamic.modal.update.form.dynameicType?r("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:e.dynamic.modal.update.form.visitTime,callback:function(t){e.$set(e.dynamic.modal.update.form,"visitTime",t)},expression:"dynamic.modal.update.form.visitTime"}}):r("el-date-picker",{attrs:{disabled:"",type:"datetime",placeholder:"选择日期时间"},model:{value:e.dynamic.modal.update.form.visitTime,callback:function(t){e.$set(e.dynamic.modal.update.form,"visitTime",t)},expression:"dynamic.modal.update.form.visitTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"动态类型","label-width":e.dynamic.modal.update.labelWith}},[r("el-cascader",{attrs:{options:e.search.visitwayList,"change-on-select":"",placeholder:"请选择"},model:{value:e.dynamic.modal.update.form.visitway,callback:function(t){e.$set(e.dynamic.modal.update.form,"visitway",t)},expression:"dynamic.modal.update.form.visitway"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"内容","label-width":e.dynamic.modal.update.labelWith}},[r("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.dynamic.modal.update.form.visitContent,callback:function(t){e.$set(e.dynamic.modal.update.form,"visitContent",t)},expression:"dynamic.modal.update.form.visitContent"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.updateOrderSaleDynamicSubmit}},[e._v("确 定")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dynamic.modal.update.visible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog",attrs:{title:"动态打卡",visible:e.dynamic.modal.open.visible},on:{"update:visible":function(t){return e.$set(e.dynamic.modal.open,"visible",t)}}},[r("baidu-map",{staticClass:"map",attrs:{center:e.center,zoom:e.zoom,"scroll-wheel-zoom":!0}},[r("bm-marker",{attrs:{position:e.position,dragging:!0,"auto-viewport":!0,animation:"BMAP_ANIMATION_BOUNCE"}},[r("bm-info-window",{staticStyle:{"font-size":"14px"},attrs:{show:!0},on:{close:e.infoWindowClose,open:e.infoWindowOpen}},[r("p",[e._v("打卡地址："+e._s(e.positionAadress))])])],1)],1)],1),e._v(" "),r("div",{staticStyle:{height:"15px"}}),e._v(" "),r("el-dialog",{staticClass:"custom-dialog dialog-double-line table-dialog",attrs:{title:"付款",visible:e.installmentItem.visible},on:{"update:visible":function(t){return e.$set(e.installmentItem,"visible",t)}}},[r("div",{staticClass:"order-search",staticStyle:{width:"630px",float:"left","margin-top":"-5px"}},[r("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容","suffix-icon":"el-icon-search"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearch(t)}},model:{value:e.installmentItem.search.keyword,callback:function(t){e.$set(e.installmentItem.search,"keyword",t)},expression:"installmentItem.search.keyword"}})],1),e._v(" "),r("el-button",{staticStyle:{"margin-bottom":"15px","margin-top":"-5px",float:"right"},attrs:{type:"primary"},on:{click:e.addInstallment}},[e._v("添加收款项\n        ")]),e._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.order.installments,height:"500"}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"fund",label:"收款项",width:"150","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"money",label:"收款金额",width:"180","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{label:"收款时间",width:"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.formatTimeStamp(t.row.createTime)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"remark",label:"备注","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{label:"审核状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{on:{click:function(r){return e.getInstaStatus(t.row)}}},[e._v(e._s(e.getInstaStatus(t.row).desc))])]}}])}),e._v(" "),r("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.showEditor(t.row)?r("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.editorOrderInstallmentItem(t.row)}}},[e._v("编辑\n                    ")]):r("el-button",{attrs:{disabled:"",type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.editorOrderInstallmentItem(t.row)}}},[e._v("编辑\n                    ")]),e._v(" "),e.showEditor(t.row)?r("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.removeOrderInstallmentItem(t.$index,t.row.coiId)}}},[e._v("移除\n                    ")]):r("el-button",{attrs:{disabled:"",type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.removeOrderInstallmentItem(t.$index,t.row.coiId)}}},[e._v("移除\n                    ")])]}}])})],1),e._v(" "),r("div",{staticClass:"order-table-total"},[e._v("\n            合计："+e._s(e.getMoneys())+"\n        ")])],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog",attrs:{title:"添加收款项",visible:e.installmentItem.insert.visible},on:{"update:visible":function(t){return e.$set(e.installmentItem.insert,"visible",t)}}},[r("el-form",{attrs:{model:e.installmentItem.insert.form}},[r("el-form-item",{attrs:{label:"收款项","label-width":e.installmentItem.insert.width,prop:"userCount"}},[r("el-input",{attrs:{placeholder:"请输入收款项"},model:{value:e.installmentItem.insert.form.fund,callback:function(t){e.$set(e.installmentItem.insert.form,"fund",t)},expression:"installmentItem.insert.form.fund"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"收款金额","label-width":e.installmentItem.insert.width,prop:"userCount"}},[r("el-input",{attrs:{type:"number",placeholder:"请输入收款金额"},model:{value:e.installmentItem.insert.form.money,callback:function(t){e.$set(e.installmentItem.insert.form,"money",t)},expression:"installmentItem.insert.form.money"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注","label-width":e.installmentItem.insert.width}},[r("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.installmentItem.insert.form.remark,callback:function(t){e.$set(e.installmentItem.insert.form,"remark",t)},expression:"installmentItem.insert.form.remark"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.insertInstallment}},[e._v("保 存")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.insertSubmitInsertInstallmentIem}},[e._v("提 交")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog",attrs:{title:"编辑收款项",visible:e.installmentItem.update.visible},on:{"update:visible":function(t){return e.$set(e.installmentItem.update,"visible",t)}}},[r("el-form",{attrs:{model:e.installmentItem.update.form}},[r("el-form-item",{attrs:{label:"收款项","label-width":e.installmentItem.update.width,prop:"userCount"}},[r("el-input",{attrs:{placeholder:"请输入收款项"},model:{value:e.installmentItem.update.form.fund,callback:function(t){e.$set(e.installmentItem.update.form,"fund",t)},expression:"installmentItem.update.form.fund"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"收款金额","label-width":e.installmentItem.update.width,prop:"userCount"}},[r("el-input",{attrs:{type:"number",placeholder:"请输入收款金额"},model:{value:e.installmentItem.update.form.money,callback:function(t){e.$set(e.installmentItem.update.form,"money",t)},expression:"installmentItem.update.form.money"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注","label-width":e.installmentItem.update.width}},[r("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.installmentItem.update.form.remark,callback:function(t){e.$set(e.installmentItem.update.form,"remark",t)},expression:"installmentItem.update.form.remark"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.editorInsertInstallmentIem}},[e._v("保 存")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.editorsubmitInsertInstallmentIem}},[e._v("提 交")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"order-header-font"},[t("div",{staticClass:"order-header-font1"},[this._v("订单类型")]),this._v(" "),t("div",{staticClass:"order-header-font2"},[this._v("新订单")])])}]};var h=r("C7Lr")(f,v,!1,function(e){r("Tgwv"),r("ysFF")},"data-v-625497e3",null);t.a=h.exports},"9J02":function(e,t){},QO7k:function(e,t,r){"use strict";var a=r("4YfN"),o=r.n(a),i=r("39zi"),s=r("G+Zt"),l=r("Week"),n=r("hFFN"),d=r("GObz"),m=r("2bvH"),c=r("ryJa"),u=r.n(c),p=r("sqb0"),f=r.n(p),v={props:["customer"],data:function(){return{value:"",order:{orderNo:"",customerId:null,customerName:"",orderType:1,contract:"",userId:"",userName:"",totalMoney:"",linkmanid:"",contacts:"",mobile:"",orderTime:"",openTime:"",remark:"",contractFiles:[],contractFileList:[],orderFiles:[],orderFileList:[],orderItems:[],toUser:"",installments:[],installmentdelete:[]},orderItem:{modal:{visible:!1,width:"122px",products:[],form:{itemId:"",productId:null,productName:"",productVersion:"",userCount:null,deliveryPackage:"",standardContractMoney:"",userCountMoney:null,implMoney:null,discountMoney:null,discountTotalMoney:null,openAccountTime:null,expireTime:null,expire:""}},update:{visible:!1,width:"122px",index:null,form:{itemId:"",productId:null,productName:"",productVersion:"",userCount:null,deliveryPackage:"",standardContractMoney:"",userCountMoney:null,implMoney:null,discountMoney:null,discountTotalMoney:null,openAccountTime:null,expireTime:null,expire:""}}},installmentItem:{visible:!1,search:{keyword:""},insert:{visible:!1,width:"70px",form:{orderId:"",fund:"",money:null,status:"",remark:"",createTime:""}},update:{visible:!1,width:"70px",index:null,form:{orderId:"",fund:"",money:null,status:"",remark:"",createTime:""}}},readonly:!1,fileList:{orders:[],contracts:[]},userModal:{visible:!1,dataList:[],value:""},dynamic:{dynamicList:[],modal:{insert:{visible:!1,labelWith:"80px",form:{dynamicId:"",orderId:"",visitTime:"",visitway:"",visitContent:""}},update:{visible:!1,labelWith:"80px",form:{orderId:"",dynamicId:"",visitTime:"",visitway:"",visitContent:""}}}},search:{visitwayList:[{value:"电话拜访",label:"电话拜访"},{value:"上门拜访",label:"上门拜访"}],app:{value:"",appList:[{label:"SAP-B1",value:"SAP-B1"},{label:"云MES",value:"云MES"},{label:"CRM",value:"CRM"}]}}}},computed:o()({},Object(m.c)(["loginUserInfo"]),{fileUploadUrl:function(){return this.$global.baseUrl+"/file/upload"},requestHeader:function(){return{"yyt-crm-token":f.a.get("yyt-crm-token")}}}),mounted:function(){this.saleProductList(),this.renderSaleOrderInfo(),this.getSaleOrderEAUserList()},methods:{addDynamic:function(){this.dynamic.modal.insert.form.visitTime="",this.dynamic.modal.insert.form.visitway="电话拜访",this.dynamic.modal.insert.form.visitContent="",this.dynamic.modal.insert.visible=!0},addOrderSaleDynamicSubmit:function(){var e=this;console.log(this.customer.orderId),this.dynamic.modal.insert.form.orderId=this.customer.orderId,Object(n.h)(this.dynamic.modal.insert.form).then(function(t){t.data.code===e.$global.successCode&&(e.$message({message:"添加成功",type:"success"}),e.dynamic.modal.insert.visible=!1)}).catch(function(e){})},calculatessssMoney:function(){this.orderItem.modal.form.standardContractMoney=this.calculateMoney(this.orderItem.modal.form.userCountMoney)+this.calculateMoney(this.orderItem.modal.form.implMoney),this.orderItem.modal.form.discountTotalMoney=this.calculateMoney(this.orderItem.modal.form.standardContractMoney)-this.calculateMoney(this.orderItem.modal.form.discountMoney)},afterDiscountMoney:function(){this.orderItem.modal.form.discountTotalMoney=this.calculateMoney(this.orderItem.modal.form.standardContractMoney)-this.calculateMoney(this.orderItem.modal.form.discountMoney)},updateCalculatessssMoney:function(){this.orderItem.update.form.standardContractMoney=this.calculateMoney(this.orderItem.update.form.userCountMoney)+this.calculateMoney(this.orderItem.update.form.implMoney),this.orderItem.update.form.discountTotalMoney=this.calculateMoney(this.orderItem.update.form.standardContractMoney)-this.calculateMoney(this.orderItem.update.form.discountMoney)},updateAfterDiscountMoney:function(){this.orderItem.update.form.discountTotalMoney=this.calculateMoney(this.orderItem.update.form.standardContractMoney)-this.calculateMoney(this.orderItem.update.form.discountMoney)},TimeCalculate:function(){if(""===this.orderItem.modal.form.openAccountTime||null===this.orderItem.modal.form.openAccountTime)return this.$message({message:"请先选择开户时间",type:"warning"}),void(this.orderItem.modal.form.expireTime="");var e=this.formatTimeStamp(this.orderItem.modal.form.openAccountTime),t=this.formatTimeStamp(this.orderItem.modal.form.expireTime);this.orderItem.modal.form.expire=u()(t).diff(e,"days")},updateTimeCalculate:function(){if(""===this.orderItem.update.form.openAccountTime||null===this.orderItem.update.form.openAccountTime)return this.$message({message:"请先选择开户时间",type:"warning"}),void(this.orderItem.update.form.expireTime="");var e=this.formatTimeStamp(this.orderItem.update.form.openAccountTime),t=this.formatTimeStamp(this.orderItem.update.form.expireTime);this.orderItem.update.form.expire=u()(t).diff(e,"days")},getSaleOrderEAUserList:function(){Object(n.a)().then(function(e){}).catch(function(e){})},getRequestParams:function(){var e={order:this.customer.orderNo};return this.installmentItem.search.keyword&&(e.keyword=this.installmentItem.search.keyword),e},renderSaleOrderInfo:function(){var e=this;this.customer?1===this.customer.readonly?Object(n.e)(this.getRequestParams()).then(function(t){e.order=t.data.data,e.readonly=!0;for(var r=0;r<e.order.orderFileList.length;r++)e.fileList.orders.push({name:e.order.orderFileList[r].originName,uid:e.order.orderFileList[r].file,url:e.order.orderFileList[r].fileName});for(var a=0;a<e.order.contractFileList.length;a++)e.fileList.contracts.push({name:e.order.contractFileList[a].originName,uid:e.order.contractFileList[a].file,url:e.order.contractFileList[a].fileName})}).catch(function(e){}):(this.order.customerId=this.customer.customerId,this.order.customerName=this.customer.customerName,this.order.userId=this.loginUserInfo.userId,this.order.userName=this.loginUserInfo.userName):(this.order.userId=this.loginUserInfo.userId,this.order.userName=this.loginUserInfo.userName)},contractUploadBeforeRemove:function(e,t){return this.$confirm("确定删除 "+e.name+" 吗？")},contractUploadRemove:function(e,t){this.deleteFileInfo(e,this.fileList.contracts)},contractUploadSuccess:function(e,t,r){this.fileList.contracts.push({name:t.name,uid:e.data.fileName,url:e.data.download})},orderUploadBeforeRemove:function(e,t){return this.$confirm("确定删除 "+e.name+" 吗？")},orderUploadRemove:function(e,t){this.deleteFileInfo(e,this.fileList.orders)},orderUploadSuccess:function(e,t,r){this.fileList.orders.push({name:t.name,uid:e.data.fileName,url:e.data.download})},deleteFileInfo:function(e,t){Object(l.a)({fileName:e.uid}).then(function(r){for(var a=0,o=0;o<t.length;o++){t[o].uid===e.uid&&(a=o)}t.splice(a,1)}).catch(function(e){})},formatTimeStamp:function(e){return u()(e).format("YYYY-MM-DD")},addOrderItem:function(){var e=this;this.orderItem.modal.visible=!0,this.$nextTick(function(){e.$refs.orderItemForm.resetFields()})},commitOrderItem:function(){var e=this;this.$refs.orderItemForm.validate(function(t){if(!t)return!1;var r=e.orderItem.modal.form;e.order.orderItems.push({productId:r.productId,productName:r.productName,productVersion:r.productVersion,userCount:r.userCount,deliveryPackage:r.deliveryPackage,standardContractMoney:r.standardContractMoney,userCountMoney:r.userCountMoney,implMoney:r.implMoney,actualMoney:r.discountTotalMoney,discountMoney:r.discountMoney,openAccountTime:r.openAccountTime,expireTime:r.expireTime,expire:r.expire}),e.order.totalMoney=e.getTotalMoney(),e.orderItem.modal.visible=!1})},getTotalMoney:function(){var e=this,t=0;return this.order.orderItems.forEach(function(r){t+=e.getAfterDiscountMoney(r)}),t.toFixed(2)},productChange:function(e){var t=this;this.orderItem.modal.products.forEach(function(r){r.value===e&&(t.orderItem.modal.form.productName=r.label)})},updateProductChange:function(e){var t=this;this.orderItem.modal.products.forEach(function(r){r.value===e&&(t.orderItem.update.form.productName=r.label)})},saleProductList:function(){var e=this;Object(s.f)().then(function(t){e.orderItem.modal.products=t.data.data}).catch(function(e){})},calculateMoney:function(e){return e?Number(e):Number(0)},getAfterDiscountMoney:function(e){return this.calculateMoney(e.userCountMoney)+this.calculateMoney(e.implMoney)-this.calculateMoney(e.discountMoney)},editorOrderItem:function(e,t){this.orderItem.update.visible=!0,this.orderItem.update.index=t,this.orderItem.update.form.itemId=e.itemId,this.orderItem.update.form.productId=e.productId,this.orderItem.update.form.productName=e.productName,this.orderItem.update.form.productVersion=e.productVersion,this.orderItem.update.form.userCount=e.userCount,this.orderItem.update.form.deliveryPackage=e.deliveryPackage,this.orderItem.update.form.standardContractMoney=e.standardContractMoney,this.orderItem.update.form.userCountMoney=e.userCountMoney,this.orderItem.update.form.implMoney=e.implMoney,this.orderItem.update.form.discountMoney=e.discountMoney,this.orderItem.update.form.discountTotalMoney=e.actualMoney,this.orderItem.update.form.openAccountTime=e.openAccountTime,this.orderItem.update.form.expireTime=e.expireTime,this.orderItem.update.form.expire=e.expire},updateOrderItem:function(){var e=this;this.$refs.orderItemForm.validate(function(t){if(!t)return!1;var r=e.orderItem.update.form,a=e.orderItem.update.index;e.order.orderItems.splice(a,1,r),e.order.totalMoney=e.getTotalMoney(),e.orderItem.update.visible=!1,console.log(e.order.orderItems)})},removeOrderItem:function(e){var t=this;this.$confirm("是否确定移除该订单项","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.order.orderItems.splice(e,1)}).catch(function(){})},queryCustomer:function(e,t){Object(s.b)({name:e}).then(function(e){var r=[];e.data.data.forEach(function(e){r.push({id:e.value,value:e.label,contacts:e.contacts,mobile:e.mobile,linkmanId:e.linkmanid})}),t(r)}).catch(function(e){})},selectCustomer:function(e){this.order.customerId=e.id,this.order.customerName=e.value,this.order.contacts=e.contacts,this.order.mobile=e.mobile,this.order.linkmanid=e.linkmanId},queryLinkman:function(e,t){if(null===this.order.customerId)return this.$message({message:"请先选择客户",type:"warning"}),!1;Object(s.c)({companyId:this.order.customerId}).then(function(e){var r=[];e.data.data.forEach(function(e){r.push({id:e.value,value:e.label,mobile:e.mobile})}),t(r)}).catch(function(e){})},selectLinkman:function(e){this.order.contacts=e.value,this.order.linkmanid=e.id,this.order.mobile=e.mobile},submitOrderForm:function(e){var t=this;this.$refs.orderForm.validate(function(r){if(!r)return!1;t.fileList.orders.forEach(function(e){t.order.orderFiles.push(e.uid)}),t.fileList.contracts.forEach(function(e){t.order.contractFiles.push(e.uid)}),"editor"===e?(console.log(t.order.installmentdelete),console.log(t.order),Object(n.o)(t.order).then(function(e){e.data.code===t.$global.successCode&&(t.$message({message:"订单提交成功",type:"success"}),t.$emit("close-editor-tab",t.order.orderNo))}).catch(function(e){})):Object(n.m)(t.order).then(function(e){e.data.code===t.$global.successCode&&(t.$message({message:"订单保存成功",type:"success"}),t.$emit("close-add-tab"))}).catch(function(e){})})},orderForm:function(){var e=this;this.userModal.visible=!0,Object(s.d)({opKey:"ORDER_WAIT_COMMIT"}).then(function(t){t.data.code===e.$global.successCode&&(e.userModal.dataList=t.data.data)}).catch(function(e){})},orderFormSubmit:function(e){var t=this;""!==this.userModal.value?(this.order.toUser=this.userModal.value,"submit"===e?Object(n.n)(this.order).then(function(e){e.data.code===t.$global.successCode&&(t.$message({message:"订单提交成功",type:"success"}),t.order.toUser=null,t.userModal.visible=!1,t.$emit("close-add-tab"))}).catch(function(e){}):Object(n.p)(this.order).then(function(e){e.data.code===t.$global.successCode&&(t.$message({message:"订单提交成功",type:"success"}),t.order.toUser=null,t.userModal.visible=!1,t.$emit("close-editor-tab",t.order.orderNo))}).catch(function(e){})):this.$message({message:"请选择审批人",type:"warning"})},downloadAction:function(e){Object(l.c)(e.url).then(function(t){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(t.data,e.originName);else{var r=document.createElement("a"),a=window.URL.createObjectURL(t.data);r.href=a,r.download=e.name,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a)}}).catch(function(e){})},installment:function(){this.installmentItem.visible=!0},doSearch:function(){this.renderSaleOrderInfo()},addInstallment:function(){this.installmentItem.insert.visible=!0,this.installmentItem.insert.form.fund="",this.installmentItem.insert.form.money=null,this.installmentItem.insert.form.status=0,this.installmentItem.insert.form.remark=""},insertInstallment:function(){this.installmentItem.insert.visible=!1,this.order.installments.push({fund:this.installmentItem.insert.form.fund,money:this.installmentItem.insert.form.money,status:2,remark:this.installmentItem.insert.form.remark,createTime:new Date})},submitInstallment:function(){this.installmentItem.insert.visible=!1,this.order.installments.push({fund:this.installmentItem.insert.form.fund,money:this.installmentItem.insert.form.money,status:0,remark:this.installmentItem.insert.form.remark,createTime:new Date})},getMoneys:function(){var e=this,t=0;return this.order.installments.forEach(function(r){t+=e.calculateMoney(r.money)}),Object(i.b)(t.toFixed(2))+"  "+Object(i.a)(t.toFixed(2))},getInstaStatus:function(e){return Object(d.c)(e)},removeOrderInstallmentItem:function(e,t){var r=this;this.$confirm("是否确定移除该收款项","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){r.order.installments.splice(e,1),console.log(void 0!==t),void 0!==t&&r.order.installmentdelete.push(t)}).catch(function(){})},editorOrderInstallmentItem:function(e,t){this.installmentItem.update.visible=!0,this.installmentItem.update.form.fund=t.fund,this.installmentItem.update.form.money=t.money,this.installmentItem.update.form.status=t.status,this.installmentItem.update.form.remark=t.remark,this.installmentItem.update.form.coiId=t.coiId,this.installmentItem.update.index=e},editorInsertInstallmentIem:function(){this.installmentItem.update.visible=!1,this.order.installments.splice(this.installmentItem.update.index,1,{fund:this.installmentItem.update.form.fund,money:this.installmentItem.update.form.money,status:2,remark:this.installmentItem.update.form.remark,createTime:new Date})},submitInsertInstallmentIem:function(){this.installmentItem.update.visible=!1,this.order.installments.splice(this.installmentItem.update.index,1,{fund:this.installmentItem.update.form.fund,money:this.installmentItem.update.form.money,status:0,remark:this.installmentItem.update.form.remark,createTime:new Date})},showEditor:function(e){return void 0===e.coiId||(void 0!==e.coiId&&2===e.status||void 0)}}},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"sales-order sales-order-add"},[r("div",{staticClass:"box-order-operation"},[r("div",{staticClass:"box-order-operation-item1"},[e._v("销售订单")]),e._v(" "),r("div",{staticClass:"box-order-operation-item2"},[r("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.readonly,expression:"!readonly"}],attrs:{type:"primary"},on:{click:function(t){return e.submitOrderForm("save")}}},[e._v("保存")]),e._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.readonly,expression:"readonly"}],attrs:{type:"primary"},on:{click:function(t){return e.submitOrderForm("editor")}}},[e._v("保存")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.orderForm}},[e._v("提交")]),e._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.readonly,expression:"readonly"}],on:{click:e.addDynamic}},[e._v("新建动态")]),e._v(" "),r("el-button",{on:{click:e.installment}},[e._v("付 款")])],1)]),e._v(" "),r("div",{staticClass:"box-order-content"},[r("div",{staticClass:"box-order-info"},[e._m(0),e._v(" "),r("el-form",{ref:"orderForm",attrs:{inline:!0,model:e.order}},[r("div",{staticClass:"box-item-row"},[r("el-form-item",{attrs:{label:"合同编号：",prop:"contract",rules:{required:!0,message:"请输入合同编号",trigger:"blur"}}},[r("el-input",{attrs:{placeholder:"请输入合同编号",readonly:e.readonly},model:{value:e.order.contract,callback:function(t){e.$set(e.order,"contract",t)},expression:"order.contract"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"订单类型：",prop:"orderType",rules:{required:!0,message:"请选择订单类型",trigger:"blur"}}},[r("el-select",{attrs:{placeholder:"请选择订单类型"},model:{value:e.order.orderType,callback:function(t){e.$set(e.order,"orderType",t)},expression:"order.orderType"}},[r("el-option",{attrs:{label:"新购",value:1}}),e._v(" "),r("el-option",{attrs:{label:"二次销售",value:2}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"所属销售："}},[r("el-input",{attrs:{disabled:!0,readonly:!0},model:{value:e.order.userName,callback:function(t){e.$set(e.order,"userName",t)},expression:"order.userName"}})],1)],1),e._v(" "),r("div",{staticClass:"box-item-row"},[r("el-form-item",{attrs:{label:"客户名称：",prop:"customerName",rules:{required:!0,message:" ",trigger:"blur"}}},[r("el-autocomplete",{attrs:{placeholder:"请输入客户名称",clearable:!0,"fetch-suggestions":e.queryCustomer,readonly:e.readonly},on:{select:e.selectCustomer},model:{value:e.order.customerName,callback:function(t){e.$set(e.order,"customerName",t)},expression:"order.customerName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"联系人：",prop:"contacts",rules:{required:!0,message:" ",trigger:"blur"}}},[r("el-autocomplete",{attrs:{placeholder:"请输入联系人",clearable:!0,"fetch-suggestions":e.queryLinkman,readonly:e.readonly},on:{select:e.selectLinkman},model:{value:e.order.contacts,callback:function(t){e.$set(e.order,"contacts",t)},expression:"order.contacts"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"订单金额："}},[r("el-input",{attrs:{disabled:!0,readonly:!0},model:{value:e.order.totalMoney,callback:function(t){e.$set(e.order,"totalMoney",t)},expression:"order.totalMoney"}})],1)],1),e._v(" "),r("div",{staticClass:"box-item-row"},[r("el-form-item",{attrs:{label:"手机：",prop:"mobile",rules:{required:!0,message:"请输入手机号码",trigger:"blur"}}},[r("el-input",{attrs:{placeholder:"请输入手机号码"},model:{value:e.order.mobile,callback:function(t){e.$set(e.order,"mobile",t)},expression:"order.mobile"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"下单日期：",prop:"orderTime",rules:{required:!0,message:"请选择下单日期",trigger:"blur"}}},[r("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"请选择下单日期"},model:{value:e.order.orderTime,callback:function(t){e.$set(e.order,"orderTime",t)},expression:"order.orderTime"}})],1)],1),e._v(" "),r("div",{staticClass:"box-item-row"},[r("el-form-item",{staticClass:"box-item-textarea-add",attrs:{label:"备注："}},[r("el-input",{attrs:{placeholder:"请输入订单备注"},model:{value:e.order.remark,callback:function(t){e.$set(e.order,"remark",t)},expression:"order.remark"}})],1)],1),e._v(" "),r("div",{staticClass:"box-item-row box-item-row-file"},[r("el-form-item",{attrs:{label:"合同文件："}},[r("el-upload",{staticClass:"box-upload-file",attrs:{multiple:"",action:e.fileUploadUrl,headers:e.requestHeader,"on-remove":e.contractUploadRemove,"before-remove":e.contractUploadBeforeRemove,"on-success":e.contractUploadSuccess,"on-preview":e.downloadAction,"file-list":e.fileList.contracts}},[r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),e._v(" "),r("div",{staticClass:"box-item-row box-item-row-file",staticStyle:{"margin-top":"-24px"}},[r("el-form-item",{attrs:{label:"下单文件："}},[r("el-upload",{staticClass:"box-upload-file",attrs:{multiple:"",action:e.fileUploadUrl,headers:e.requestHeader,"on-remove":e.orderUploadRemove,"before-remove":e.orderUploadBeforeRemove,"on-success":e.orderUploadSuccess,"on-preview":e.downloadAction,"file-list":e.fileList.orders}},[r("i",{staticClass:"el-icon-plus avatar-uploader-icon",staticStyle:{"margin-top":"4px"}})])],1)],1)])],1),e._v(" "),r("div",{staticClass:"box-order-item-list"},[r("div",{staticClass:"box-order-item-1"},[r("div",{staticClass:"box-order-item-row-3"},[e._v("订单明细")]),e._v(" "),r("div",{staticClass:"box-order-item-row-2"},[r("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addOrderItem}},[e._v("添加")])],1)]),e._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.order.orderItems,height:"200"}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"productName",label:"产品",width:"120","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"productVersion",label:"版本/PL",width:"80","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"userCount",label:"平台用户数",width:"100","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"deliveryPackage",label:"交付包",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"standardContractMoney",label:"合同标准金额",width:"120","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"userCountMoney",label:"用户数总金额",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"implMoney",label:"实施费总金额",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"discountMoney",label:"优惠金额",width:"130","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{label:"优惠后合同总金额",width:"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.getAfterDiscountMoney(t.row)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"开户日期",width:"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.formatTimeStamp(t.row.openAccountTime)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"expireTime",label:"到期日",width:"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.formatTimeStamp(t.row.expireTime)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"expire",label:"期限",width:"120","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column"),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"130",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit"},nativeOn:{click:function(r){return r.preventDefault(),e.editorOrderItem(t.row,t.$index)}}},[e._v("编辑")]),e._v(" "),r("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-close"},nativeOn:{click:function(r){return r.preventDefault(),e.removeOrderItem(t.$index)}}},[e._v("删除")])]}}])})],1)],1)]),e._v(" "),r("el-dialog",{staticClass:"custom-dialog dialog-double-line",attrs:{title:"新建行",visible:e.orderItem.modal.visible},on:{"update:visible":function(t){return e.$set(e.orderItem.modal,"visible",t)}}},[r("el-form",{ref:"orderItemForm",attrs:{model:e.orderItem.modal.form}},[r("el-row",{attrs:{gutter:65}},[r("el-col",{attrs:{xs:12,sm:12,md:12,lg:12,xl:12}},[r("el-form-item",{attrs:{label:"产品名称","label-width":e.orderItem.modal.width,prop:"productId",rules:{required:!0,message:"请选择产品名称",trigger:"blur"}}},[r("el-select",{attrs:{placeholder:"请选择产品名称"},on:{change:e.productChange},model:{value:e.orderItem.modal.form.productId,callback:function(t){e.$set(e.orderItem.modal.form,"productId",t)},expression:"orderItem.modal.form.productId"}},e._l(e.orderItem.modal.products,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"平台用户数","label-width":e.orderItem.modal.width,prop:"userCount"}},[r("el-input",{attrs:{placeholder:"请输入平台用户数"},model:{value:e.orderItem.modal.form.userCount,callback:function(t){e.$set(e.orderItem.modal.form,"userCount",t)},expression:"orderItem.modal.form.userCount"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"实施费总金额","label-width":e.orderItem.modal.width,prop:"implMoney",rules:{required:!0,message:"请输入实施费总金额",trigger:"blur"}}},[r("el-input",{attrs:{type:"number",placeholder:"请输入实施费总金额"},on:{change:e.calculatessssMoney},model:{value:e.orderItem.modal.form.implMoney,callback:function(t){e.$set(e.orderItem.modal.form,"implMoney",t)},expression:"orderItem.modal.form.implMoney"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"合同标准金额","label-width":e.orderItem.modal.width,prop:"standardContractMoney",rules:{required:!0,message:"合同标准金额",trigger:"blur"}}},[r("el-input",{attrs:{readonly:!0,type:"number",placeholder:"合同标准金额"},model:{value:e.orderItem.modal.form.standardContractMoney,callback:function(t){e.$set(e.orderItem.modal.form,"standardContractMoney",t)},expression:"orderItem.modal.form.standardContractMoney"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"优惠后合同金额","label-width":e.orderItem.modal.width,prop:"discountTotalMoney",rules:{required:!0,message:" ",trigger:"blur"}}},[r("el-input",{attrs:{readonly:!0,type:"number",placeholder:"优惠合同金额"},model:{value:e.orderItem.modal.form.discountTotalMoney,callback:function(t){e.$set(e.orderItem.modal.form,"discountTotalMoney",t)},expression:"orderItem.modal.form.discountTotalMoney"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"到期日期","label-width":e.orderItem.modal.width,prop:"expireTime",rules:{required:!0,message:"请选择到期日期",trigger:"blur"}}},[r("el-date-picker",{attrs:{type:"date","value-format":"timestamp",placeholder:"请选择到期日期"},on:{change:e.TimeCalculate},model:{value:e.orderItem.modal.form.expireTime,callback:function(t){e.$set(e.orderItem.modal.form,"expireTime",t)},expression:"orderItem.modal.form.expireTime"}})],1)],1),e._v(" "),r("el-col",{attrs:{xs:12,sm:12,md:12,lg:12,xl:12}},[r("el-form-item",{attrs:{label:"版本/PL","label-width":e.orderItem.modal.width,prop:"productVersion",rules:{required:!0,message:"请输入版本/PL",trigger:"blur"}}},[r("el-input",{attrs:{placeholder:"请输入版本/PL"},model:{value:e.orderItem.modal.form.productVersion,callback:function(t){e.$set(e.orderItem.modal.form,"productVersion",t)},expression:"orderItem.modal.form.productVersion"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"交付包","label-width":e.orderItem.modal.width,prop:"deliveryPackage"}},[r("el-input",{attrs:{placeholder:"请输入交付包"},model:{value:e.orderItem.modal.form.deliveryPackage,callback:function(t){e.$set(e.orderItem.modal.form,"deliveryPackage",t)},expression:"orderItem.modal.form.deliveryPackage"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"用户数总金额","label-width":e.orderItem.modal.width,prop:"userCountMoney",rules:{required:!0,message:"请输入用户数总金额",trigger:"blur"}}},[r("el-input",{attrs:{type:"number",placeholder:"请输入用户数总金额"},on:{change:e.calculatessssMoney},model:{value:e.orderItem.modal.form.userCountMoney,callback:function(t){e.$set(e.orderItem.modal.form,"userCountMoney",t)},expression:"orderItem.modal.form.userCountMoney"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"优惠金额","label-width":e.orderItem.modal.width,prop:"discountMoney",rules:{required:!0,message:"请输入优惠金额",trigger:"blur"}}},[r("el-input",{attrs:{type:"number",placeholder:"请输入优惠金额"},on:{change:e.afterDiscountMoney},model:{value:e.orderItem.modal.form.discountMoney,callback:function(t){e.$set(e.orderItem.modal.form,"discountMoney",t)},expression:"orderItem.modal.form.discountMoney"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"开户日期","label-width":e.orderItem.modal.width,prop:"openAccountTime",rules:{required:!0,message:"请选择开户日期",trigger:"blur"}}},[r("el-date-picker",{attrs:{type:"date","value-format":"timestamp",placeholder:"请选择开户日期"},model:{value:e.orderItem.modal.form.openAccountTime,callback:function(t){e.$set(e.orderItem.modal.form,"openAccountTime",t)},expression:"orderItem.modal.form.openAccountTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"期限(天)","label-width":e.orderItem.modal.width,prop:"expire"}},[r("el-input",{attrs:{readonly:!0,placeholder:"请输入期限"},model:{value:e.orderItem.modal.form.expire,callback:function(t){e.$set(e.orderItem.modal.form,"expire",t)},expression:"orderItem.modal.form.expire"}})],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.commitOrderItem}},[e._v("确 定")]),e._v(" "),r("el-button",{on:{click:function(t){e.orderItem.modal.visible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog dialog-double-line",attrs:{title:"编辑行",visible:e.orderItem.update.visible},on:{"update:visible":function(t){return e.$set(e.orderItem.update,"visible",t)}}},[r("el-form",{ref:"orderItemForm",attrs:{model:e.orderItem.update.form}},[r("el-row",{attrs:{gutter:5}},[r("el-col",{attrs:{xs:12,sm:12,md:12,lg:12,xl:12}},[r("el-form-item",{attrs:{label:"产品名称","label-width":e.orderItem.update.width,prop:"productId",rules:{required:!0,message:"请选择产品名称",trigger:"blur"}}},[r("el-select",{attrs:{placeholder:"请选择产品名称"},on:{change:e.updateProductChange},model:{value:e.orderItem.update.form.productId,callback:function(t){e.$set(e.orderItem.update.form,"productId",t)},expression:"orderItem.update.form.productId"}},e._l(e.orderItem.modal.products,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"平台用户数","label-width":e.orderItem.update.width,prop:"userCount"}},[r("el-input",{attrs:{placeholder:"请输入平台用户数"},model:{value:e.orderItem.update.form.userCount,callback:function(t){e.$set(e.orderItem.update.form,"userCount",t)},expression:"orderItem.update.form.userCount"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"实施费总金额","label-width":e.orderItem.update.width,prop:"implMoney",rules:{required:!0,message:"请输入实施费总金额",trigger:"blur"}}},[r("el-input",{attrs:{type:"number",placeholder:"请输入实施费总金额"},on:{change:e.updateCalculatessssMoney},model:{value:e.orderItem.update.form.implMoney,callback:function(t){e.$set(e.orderItem.update.form,"implMoney",t)},expression:"orderItem.update.form.implMoney"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"合同标准金额","label-width":e.orderItem.update.width,prop:"standardContractMoney",rules:{required:!0,message:"合同标准金额",trigger:"blur"}}},[r("el-input",{attrs:{readonly:!0,type:"number",placeholder:"合同标准金额"},model:{value:e.orderItem.update.form.standardContractMoney,callback:function(t){e.$set(e.orderItem.update.form,"standardContractMoney",t)},expression:"orderItem.update.form.standardContractMoney"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"优惠后合同金额","label-width":e.orderItem.update.width,prop:"discountTotalMoney",rules:{required:!0,message:" ",trigger:"blur"}}},[r("el-input",{attrs:{readonly:!0,type:"number",placeholder:"优惠合同金额"},model:{value:e.orderItem.update.form.discountTotalMoney,callback:function(t){e.$set(e.orderItem.update.form,"discountTotalMoney",t)},expression:"orderItem.update.form.discountTotalMoney"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"到期日期","label-width":e.orderItem.update.width,prop:"expireTime",rules:{required:!0,message:"请选择到期日期",trigger:"blur"}}},[r("el-date-picker",{attrs:{type:"date","value-format":"timestamp",placeholder:"请选择到期日期"},on:{change:e.updateTimeCalculate},model:{value:e.orderItem.update.form.expireTime,callback:function(t){e.$set(e.orderItem.update.form,"expireTime",t)},expression:"orderItem.update.form.expireTime"}})],1)],1),e._v(" "),r("el-col",{attrs:{xs:12,sm:12,md:12,lg:12,xl:12}},[r("el-form-item",{attrs:{label:"版本/PL","label-width":e.orderItem.update.width,prop:"productVersion",rules:{required:!0,message:"请输入版本/PL",trigger:"blur"}}},[r("el-input",{attrs:{placeholder:"请输入版本/PL"},model:{value:e.orderItem.update.form.productVersion,callback:function(t){e.$set(e.orderItem.update.form,"productVersion",t)},expression:"orderItem.update.form.productVersion"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"交付包","label-width":e.orderItem.update.width,prop:"deliveryPackage"}},[r("el-input",{attrs:{placeholder:"请输入交付包"},model:{value:e.orderItem.update.form.deliveryPackage,callback:function(t){e.$set(e.orderItem.update.form,"deliveryPackage",t)},expression:"orderItem.update.form.deliveryPackage"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"用户数总金额","label-width":e.orderItem.update.width,prop:"userCountMoney",rules:{required:!0,message:"请输入用户数总金额",trigger:"blur"}}},[r("el-input",{attrs:{type:"number",placeholder:"请输入用户数总金额"},on:{change:e.updateCalculatessssMoney},model:{value:e.orderItem.update.form.userCountMoney,callback:function(t){e.$set(e.orderItem.update.form,"userCountMoney",t)},expression:"orderItem.update.form.userCountMoney"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"优惠金额","label-width":e.orderItem.update.width,prop:"discountMoney",rules:{required:!0,message:"请输入优惠金额",trigger:"blur"}}},[r("el-input",{attrs:{type:"number",placeholder:"请输入优惠金额"},on:{change:e.updateAfterDiscountMoney},model:{value:e.orderItem.update.form.discountMoney,callback:function(t){e.$set(e.orderItem.update.form,"discountMoney",t)},expression:"orderItem.update.form.discountMoney"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"开户日期","label-width":e.orderItem.update.width,prop:"openAccountTime",rules:{required:!0,message:"请选择开户日期",trigger:"blur"}}},[r("el-date-picker",{attrs:{type:"date","value-format":"timestamp",placeholder:"请选择开户日期"},model:{value:e.orderItem.update.form.openAccountTime,callback:function(t){e.$set(e.orderItem.update.form,"openAccountTime",t)},expression:"orderItem.update.form.openAccountTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"期限(天)","label-width":e.orderItem.update.width,prop:"expire"}},[r("el-input",{attrs:{readonly:!0,placeholder:"请输入期限"},model:{value:e.orderItem.update.form.expire,callback:function(t){e.$set(e.orderItem.update.form,"expire",t)},expression:"orderItem.update.form.expire"}})],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.updateOrderItem}},[e._v("确 定")]),e._v(" "),r("el-button",{on:{click:function(t){e.orderItem.update.visible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog",attrs:{title:"选择审批人",visible:e.userModal.visible},on:{"update:visible":function(t){return e.$set(e.userModal,"visible",t)}}},[r("el-form",[r("el-form-item",[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.userModal.value,callback:function(t){e.$set(e.userModal,"value",t)},expression:"userModal.value"}},e._l(e.userModal.dataList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.readonly,expression:"!readonly"}],attrs:{type:"primary"},on:{click:function(t){return e.orderFormSubmit("submit")}}},[e._v("确 定")]),e._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:e.readonly,expression:"readonly"}],attrs:{type:"primary"},on:{click:function(t){return e.orderFormSubmit("editor")}}},[e._v("确 定")]),e._v(" "),r("el-button",{on:{click:function(t){e.userModal.visible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog",attrs:{title:"添加动态",visible:e.dynamic.modal.insert.visible},on:{"update:visible":function(t){return e.$set(e.dynamic.modal.insert,"visible",t)}}},[r("el-form",{attrs:{model:e.dynamic.modal.insert.form}},[r("el-form-item",{attrs:{label:"拜访时间","label-width":e.dynamic.modal.insert.labelWith}},[r("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:e.dynamic.modal.insert.form.visitTime,callback:function(t){e.$set(e.dynamic.modal.insert.form,"visitTime",t)},expression:"dynamic.modal.insert.form.visitTime"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"拜访方式","label-width":e.dynamic.modal.insert.labelWith}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.dynamic.modal.insert.form.visitway,callback:function(t){e.$set(e.dynamic.modal.insert.form,"visitway",t)},expression:"dynamic.modal.insert.form.visitway"}},e._l(e.search.visitwayList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"内容","label-width":e.dynamic.modal.insert.labelWith}},[r("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.dynamic.modal.insert.form.visitContent,callback:function(t){e.$set(e.dynamic.modal.insert.form,"visitContent",t)},expression:"dynamic.modal.insert.form.visitContent"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.addOrderSaleDynamicSubmit}},[e._v("确 定")]),e._v(" "),r("el-button",{on:{click:function(t){e.dynamic.modal.insert.visible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog dialog-double-line table-dialog",attrs:{title:"付款",visible:e.installmentItem.visible},on:{"update:visible":function(t){return e.$set(e.installmentItem,"visible",t)}}},[r("div",{staticClass:"order-search",staticStyle:{width:"80%",float:"left","margin-top":"-5px"}},[r("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容","suffix-icon":"el-icon-search"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearch(t)}},model:{value:e.installmentItem.search.keyword,callback:function(t){e.$set(e.installmentItem.search,"keyword",t)},expression:"installmentItem.search.keyword"}})],1),e._v(" "),r("el-button",{staticStyle:{"margin-bottom":"15px","margin-top":"-5px",float:"right"},attrs:{type:"primary"},on:{click:e.addInstallment}},[e._v("添加收款项")]),e._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.order.installments,height:"500"}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{prop:"fund",label:"收款项",width:"150","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"money",label:"收款金额",width:"180","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{label:"收款时间",width:"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.formatTimeStamp(t.row.createTime)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"remark",label:"备注","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{label:"审核状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{on:{click:function(r){return e.getInstaStatus(t.row)}}},[e._v(e._s(e.getInstaStatus(t.row).desc))])]}}])}),e._v(" "),r("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.showEditor(t.row)?r("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.editorOrderInstallmentItem(t.$index,t.row)}}},[e._v("编辑")]):r("el-button",{attrs:{disabled:"",type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.editorOrderInstallmentItem(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),e.showEditor(t.row)?r("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.removeOrderInstallmentItem(t.$index,t.row.coiId)}}},[e._v("移除")]):r("el-button",{attrs:{disabled:"",type:"text",size:"small"},nativeOn:{click:function(r){return r.preventDefault(),e.removeOrderInstallmentItem(t.$index,t.row.coiId)}}},[e._v("移除")])]}}])})],1),e._v(" "),r("div",{staticClass:"order-table-total"},[e._v("\n            合计："+e._s(e.getMoneys())+"\n        ")])],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog",attrs:{title:"添加收款项",visible:e.installmentItem.insert.visible},on:{"update:visible":function(t){return e.$set(e.installmentItem.insert,"visible",t)}}},[r("el-form",{attrs:{model:e.installmentItem.insert.form}},[r("el-form-item",{attrs:{label:"收款项","label-width":e.installmentItem.insert.width,prop:"userCount"}},[r("el-input",{attrs:{placeholder:"请输入收款项"},model:{value:e.installmentItem.insert.form.fund,callback:function(t){e.$set(e.installmentItem.insert.form,"fund",t)},expression:"installmentItem.insert.form.fund"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"收款金额","label-width":e.installmentItem.insert.width,prop:"userCount"}},[r("el-input",{attrs:{type:"number",placeholder:"请输入收款金额"},model:{value:e.installmentItem.insert.form.money,callback:function(t){e.$set(e.installmentItem.insert.form,"money",t)},expression:"installmentItem.insert.form.money"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注","label-width":e.installmentItem.insert.width}},[r("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.installmentItem.insert.form.remark,callback:function(t){e.$set(e.installmentItem.insert.form,"remark",t)},expression:"installmentItem.insert.form.remark"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.insertInstallment}},[e._v("保 存")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.submitInstallment}},[e._v("提 交")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"custom-dialog",attrs:{title:"编辑收款项",visible:e.installmentItem.update.visible},on:{"update:visible":function(t){return e.$set(e.installmentItem.update,"visible",t)}}},[r("el-form",{attrs:{model:e.installmentItem.update.form}},[r("el-form-item",{attrs:{label:"收款项","label-width":e.installmentItem.update.width,prop:"userCount"}},[r("el-input",{attrs:{placeholder:"请输入收款项"},model:{value:e.installmentItem.update.form.fund,callback:function(t){e.$set(e.installmentItem.update.form,"fund",t)},expression:"installmentItem.update.form.fund"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"收款金额","label-width":e.installmentItem.update.width,prop:"userCount"}},[r("el-input",{attrs:{type:"number",placeholder:"请输入收款金额"},model:{value:e.installmentItem.update.form.money,callback:function(t){e.$set(e.installmentItem.update.form,"money",t)},expression:"installmentItem.update.form.money"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注","label-width":e.installmentItem.update.width}},[r("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.installmentItem.update.form.remark,callback:function(t){e.$set(e.installmentItem.update.form,"remark",t)},expression:"installmentItem.update.form.remark"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:e.editorInsertInstallmentIem}},[e._v("保 存")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.submitInsertInstallmentIem}},[e._v("提 交")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"box-order-item-1"},[t("div",{staticClass:"box-order-item-row-1"},[this._v("基础信息")])])}]};var b=r("C7Lr")(v,h,!1,function(e){r("t4vN"),r("b0rq")},"data-v-1caa0b3f",null);t.a=b.exports},Tgwv:function(e,t){},Y1jH:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("4YfN"),o=r.n(a),i=r("hFFN"),s=r("iz/j"),l=r("xzFr"),n=r("2bvH"),d=r("ryJa"),m=r.n(d),c={props:["status"],data:function(){return{table:{loading:!1,dataList:[]},pageObject:{page:this.$global.pageParam.page,size:this.$global.pageParam.size,total:this.$global.pageParam.total},search:{keyword:""}}},computed:o()({},Object(n.c)(["orderStatus","loginUserInfo"])),mounted:function(){this.status.name===this.$global.orderAllTab&&this.doSearch("")},methods:{showStart:function(e){return e===this.loginUserInfo.userId},handleChange:function(){this.listOrder(this.getRequestParams())},listOrder:function(e){var t=this;this.table.loading=!0,Object(i.f)(e).then(function(e){console.log(e.data.data);var r=e.data.data;t.pageObject.total=r.total,t.table.dataList=r.list,t.table.loading=!1}).catch(function(e){t.table.loading=!1})},showOrderDetail:function(e){e.readonly=2,this.$emit("order-detail",e)},showOrderDetailEditor:function(e){e.readonly=1,this.$emit("order-detail",e)},showOrderDetailBatch:function(e){e.readonly=3,this.$emit("order-detail",e)},transOrderStatus:function(e){for(var t=0;t<this.orderStatus.length;t++){var r=this.orderStatus[t];if(r.key===e)return r.name}return"未知状态"},formatTimeStamp:function(e){return m()(e).format("YYYY-MM-DD HH:mm:ss")},formatMoney:function(e){return null!=e?e.toFixed(2):0},doSearch:function(e){this.pageObject.page=1,this.search.keyword=e,this.listOrder(this.getRequestParams())},getRequestParams:function(){var e={page:this.pageObject.page,size:this.pageObject.size};return this.search.keyword&&(e.keyword=this.search.keyword),this.status.name!==this.$global.orderAllTab&&(e.status=this.status.name),e},operation:function(e){return e.substring(1)}},components:{pagination:l.a}},u={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main-order-content"},[r("div",{staticClass:"order-common-table"},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.table.loading,expression:"table.loading"}],staticStyle:{width:"100%"},attrs:{data:e.table.dataList,height:"100%"}},[r("el-table-column",{attrs:{type:"index",width:"43"}}),e._v(" "),r("el-table-column",{attrs:{width:"210",label:"订单号"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticClass:"text-click",on:{click:function(r){return e.showOrderDetail(t.row)}}},[e._v(e._s(t.row.orderNo))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"userName",width:"80",label:"创建人"}}),e._v(" "),r("el-table-column",{attrs:{prop:"customerName",label:"客户名称","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"contacts",label:"联系人","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{prop:"mobile",label:"手机","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{label:"订单状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.transOrderStatus(t.row.orderStatus)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"订单日期",sortable:"","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.formatTimeStamp(t.row.createTime)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"订单金额","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.formatMoney(t.row.totalMoney)))])]}}])}),e._v(" "),0!==e.status.tabIndex&&"ORDER_COMPLETE"!==e.status.name?r("el-table-column",{attrs:{label:"操作",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===e.status.tabIndex?r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.showOrderDetailEditor(t.row)}}},[e._v("编辑")]):e.showStart(t.row.cuUserId)?r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.showOrderDetailBatch(t.row)}}},[e._v(e._s(e.operation(e.status.label)))]):r("el-button",{attrs:{type:"text",size:"small",disabled:""},on:{click:function(r){return e.showOrderDetailBatch(t.row)}}},[e._v(e._s(e.operation(e.status.label)))])]}}],null,!1,1315888214)}):e._e()],1)],1),e._v(" "),r("pagination",{attrs:{"page-object":e.pageObject},on:{pageChange:e.handleChange}})],1)},staticRenderFns:[]};var p=r("C7Lr")(c,u,!1,function(e){r("7V40")},"data-v-6f1be51a",null).exports,f=r("8Cq6"),v=r("QO7k"),h={data:function(){return{customerInfo:null,tabs:{active:"1",items:[]},itemTabs:{defaultTabIndex:0,active:this.$global.orderAllTab,items:[{tabIndex:0,name:this.$global.orderAllTab,label:"所有订单"}]},search:{keyword:""}}},computed:{breadcrumb:function(){var e=[{index:1,title:"首页"},{index:2,title:"订单管理"},{index:3,title:"销售订单"}];return"1"===this.tabs.active?e.push({index:4,title:"订单列表"}):"insert-sales-order"===this.tabs.active?e.push({index:4,title:"新增订单"}):e.push({index:4,title:"订单详情"}),e}},mounted:function(){this.salesOrderAuditProccess()},methods:o()({},Object(n.b)(["setOrderStatus","setOrderStatusUser"]),{salesOrderAuditProccess:function(){var e=this;Object(i.g)().then(function(t){var r=[];t.data.data.forEach(function(t,a){e.itemTabs.items.push({tabIndex:a+1,name:t.opKey,label:t.opName}),r.push({key:t.opKey,name:t.opName})}),e.setOrderStatus(r)}).catch(function(e){})},addMainCardTabs:function(e,t,r){var a=this.tabs.items;if(a.length>=7)this.$message({message:"请关闭多余的标签页",type:"warning"});else{for(var o=!0,i=2===e?"insert-sales-order":t.orderNo,s=0;s<a.length;s++){if(a[s].name===i){o=!1;break}}o&&(1===e?this.tabs.items.push({title:"订单详情",name:i,orderInfo:t,status:r}):2===e?this.tabs.items.push({title:"新建订单",name:i,status:r}):3===e&&this.tabs.items.push({title:"编辑订单",name:i,customerInfo:t,status:r})),this.tabs.active=i}},removeMainCardTabs:function(e){if("1"!==e){var t=this.tabs.items,r=this.tabs.active;this.tabs.active===e&&(t.forEach(function(a,o){if(a.name===e){var i=t[o+1]||t[o-1];i&&(r=i.name)}}),this.tabs.active=r),this.tabs.items=t.filter(function(t){return t.name!==e}),0===this.tabs.items.length&&(this.tabs.active="1")}else this.$message({message:"该标签不能被关闭",type:"warning"})},changeComponent:function(e){this.itemTabs.defaultTabIndex=e.index,this.search.keyword="",this.doSearch()},doSearch:function(){this.$refs.childTabs[this.itemTabs.defaultTabIndex].doSearch(this.search.keyword)},showOrderDetail:function(e){1===e.readonly?this.addMainCardTabs(3,e,this.itemTabs):this.addMainCardTabs(1,e,this.itemTabs)},addSalesOrder:function(){this.addMainCardTabs(2,null,this.itemTabs)},closeDetailOrderTab:function(e){this.removeMainCardTabs(e),this.$refs.childTabs[this.itemTabs.defaultTabIndex].doSearch("")},closeAddOrderTab:function(){this.removeMainCardTabs("insert-sales-order"),this.tabs.active="1",this.$refs.childTabs[0].doSearch("")},closeEditorOrderTab:function(e){this.removeMainCardTabs(e),this.$refs.childTabs[this.itemTabs.defaultTabIndex].doSearch("")}}),components:{breadcrumb:s.a,"order-list":p,"order-detail":f.a,"order-sales-add":v.a}},b={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main-content"},[r("breadcrumb",{attrs:{items:e.breadcrumb}}),e._v(" "),r("div",{staticClass:"tabs-box"},["1"==e.tabs.active?r("div",{staticClass:"order-button-search"},[r("el-button",{attrs:{type:"primary"},on:{click:e.addSalesOrder}},[e._v("新建销售订单")]),e._v(" "),r("div",{staticClass:"order-search"},[r("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容","suffix-icon":"el-icon-search"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSearch(t)}},model:{value:e.search.keyword,callback:function(t){e.$set(e.search,"keyword",t)},expression:"search.keyword"}})],1)],1):e._e(),e._v(" "),r("el-tabs",{staticClass:"main-card-tabs",attrs:{type:"card",closable:""},on:{"tab-remove":e.removeMainCardTabs},model:{value:e.tabs.active,callback:function(t){e.$set(e.tabs,"active",t)},expression:"tabs.active"}},[r("el-tab-pane",{attrs:{label:"销售订单",name:"1"}},[r("el-tabs",{staticClass:"order-tabs",on:{"tab-click":e.changeComponent},model:{value:e.itemTabs.active,callback:function(t){e.$set(e.itemTabs,"active",t)},expression:"itemTabs.active"}},e._l(e.itemTabs.items,function(t){return r("el-tab-pane",{key:t.name,attrs:{label:t.label,name:t.name}},[r("order-list",{ref:"childTabs",refInFor:!0,attrs:{status:t},on:{"order-detail":e.showOrderDetail}})],1)}),1)],1),e._v(" "),e._l(e.tabs.items,function(t){return r("el-tab-pane",{key:t.name,attrs:{label:t.title,name:t.name}},[t.orderInfo?r("order-detail",{attrs:{status:t.status,"order-info":t.orderInfo},on:{"close-detail-tab":e.closeDetailOrderTab}}):r("order-sales-add",{attrs:{customer:t.customerInfo},on:{"close-add-tab":e.closeAddOrderTab,"close-editor-tab":e.closeEditorOrderTab}})],1)})],2)],1)],1)},staticRenderFns:[]};var y=r("C7Lr")(h,b,!1,function(e){r("uAgs"),r("9J02")},"data-v-7dc40937",null);t.default=y.exports},b0rq:function(e,t){},t4vN:function(e,t){},uAgs:function(e,t){},ysFF:function(e,t){}});